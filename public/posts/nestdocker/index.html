<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Dockerize NestJS | Hsuan's Coding Blog</title>
<meta name=keywords content="NodeJS,NestJS,Back-end,Docker"><meta name=description content='This article provide a straightforward guide to dockerizing NestJS application for both develpoment and production environments.
Dockerfile for Development First, let&rsquo;s create a Dockerfile.dev for the development environment within our NestJS repository:
# Dockerfile.dev FROM node:20-alpine WORKDIR /usr/src/app EXPOSE 3000 CMD ["npm", "run", "start:dev"] COPY package*.json ./ RUN npm install COPY . . In this Dockerfile, we specify the Node.js version along with the Alpine Linux distribution to minimize the image size.'><meta name=author content="HSIAO, YI-HUSAN"><link rel=canonical href=https://hsuanblog.live/posts/nestdocker/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://hsuanblog.live/posts/nestdocker/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="How to Dockerize NestJS"><meta property="og:description" content='This article provide a straightforward guide to dockerizing NestJS application for both develpoment and production environments.
Dockerfile for Development First, let&rsquo;s create a Dockerfile.dev for the development environment within our NestJS repository:
# Dockerfile.dev FROM node:20-alpine WORKDIR /usr/src/app EXPOSE 3000 CMD ["npm", "run", "start:dev"] COPY package*.json ./ RUN npm install COPY . . In this Dockerfile, we specify the Node.js version along with the Alpine Linux distribution to minimize the image size.'><meta property="og:type" content="article"><meta property="og:url" content="https://hsuanblog.live/posts/nestdocker/"><meta property="og:image" content="https://hsuanblog.live/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-14T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-14T00:00:00+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://hsuanblog.live/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="How to Dockerize NestJS"><meta name=twitter:description content='This article provide a straightforward guide to dockerizing NestJS application for both develpoment and production environments.
Dockerfile for Development First, let&rsquo;s create a Dockerfile.dev for the development environment within our NestJS repository:
# Dockerfile.dev FROM node:20-alpine WORKDIR /usr/src/app EXPOSE 3000 CMD ["npm", "run", "start:dev"] COPY package*.json ./ RUN npm install COPY . . In this Dockerfile, we specify the Node.js version along with the Alpine Linux distribution to minimize the image size.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hsuanblog.live/posts/"},{"@type":"ListItem","position":2,"name":"How to Dockerize NestJS","item":"https://hsuanblog.live/posts/nestdocker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Dockerize NestJS","name":"How to Dockerize NestJS","description":"This article provide a straightforward guide to dockerizing NestJS application for both develpoment and production environments.\nDockerfile for Development First, let\u0026rsquo;s create a Dockerfile.dev for the development environment within our NestJS repository:\n# Dockerfile.dev FROM node:20-alpine WORKDIR /usr/src/app EXPOSE 3000 CMD [\u0026#34;npm\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;start:dev\u0026#34;] COPY package*.json ./ RUN npm install COPY . . In this Dockerfile, we specify the Node.js version along with the Alpine Linux distribution to minimize the image size.","keywords":["NodeJS","NestJS","Back-end","Docker"],"articleBody":"This article provide a straightforward guide to dockerizing NestJS application for both develpoment and production environments.\nDockerfile for Development First, let’s create a Dockerfile.dev for the development environment within our NestJS repository:\n# Dockerfile.dev FROM node:20-alpine WORKDIR /usr/src/app EXPOSE 3000 CMD [\"npm\", \"run\", \"start:dev\"] COPY package*.json ./ RUN npm install COPY . . In this Dockerfile, we specify the Node.js version along with the Alpine Linux distribution to minimize the image size. Note the order of commands such as EXPOSE and CMD to optimize Docker’s caching mechanism. Since code modifications are frequent during development, we place the COPY command towards the end of the Dockerfile to reduce rebuild time.\nNow, let’s build the image from Dockerfile.dev:\n$ docker build -t nest-dev -f Dockerfile.dev . After building, let’s check the image size:\n$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE nest-dev latest 7105d40d77e3 About a minute ago 327MB Building this Docker image with the base image node:w0-alpine yields a size of 327MB, which is quite efficient. However, if we were to use node:20 instead of node:20-alpine as the base image, the image size would increase significantly, up to 1.29GB.\nDockerfile for Production Even though 327MB is relatively small, we can further optimize the image size for the production environment by removing unnecessary files and packages during the build process. Here’s the Dockerfile.prod for production:\nFROM node:20-alpine AS builder COPY . . RUN npm install \u0026\u0026 npm run build RUN npm install --prod FROM node:20-alpine WORKDIR /usr/src/app COPY --from=builder /node_modules ./node_modules COPY --from=builder /dist ./dist EXPOSE 3000 CMD [\"node\", \"./dist/main\"] In this Dockerfile, we utilize Multi-stage builds to first compile the TypeScript code into JavaScript and then install only the production dependencies, thereby significantly reducing the image size.\nLet’s build the production image and compare the size difference with the development version:\n$ docker build -t nest-prod -f Dockerfile.prod . $ docker images REPOSITORY TAG IMAGE ID CREATED SIZE nest-dev latest 7105d40d77e3 About a minute ago 327MB nest-prod latest 04f3894b4cf6 5 minutes ago 141MB As you can see, the production image size is half of the development version, resulting in reduced tranportation time and storage requirements.\n","wordCount":"355","inLanguage":"en","image":"https://hsuanblog.live/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-05-14T00:00:00Z","dateModified":"2024-05-14T00:00:00Z","author":{"@type":"Person","name":"HSIAO, YI-HUSAN"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://hsuanblog.live/posts/nestdocker/"},"publisher":{"@type":"Organization","name":"Hsuan's Coding Blog","logo":{"@type":"ImageObject","url":"https://hsuanblog.live/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://hsuanblog.live/ accesskey=h title="Hsuan's Coding Blog (Alt + H)"><img src=https://hsuanblog.live/apple-touch-icon.png alt aria-label=logo height=35>Hsuan's Coding Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hsuanblog.live/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://hsuanblog.live/categories/ title=categories><span>categories</span></a></li><li><a href=https://hsuanblog.live/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hsuanblog.live/>Home</a>&nbsp;»&nbsp;<a href=https://hsuanblog.live/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">How to Dockerize NestJS</h1><div class=post-meta><span title='2024-05-14 00:00:00 +0000 UTC'>May 14, 2024</span>&nbsp;·&nbsp;355 words&nbsp;·&nbsp;HSIAO, YI-HUSAN</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#dockerfile-for-development>Dockerfile for Development</a></li><li><a href=#dockerfile-for-production>Dockerfile for Production</a></li></ul></nav></div></details></div><div class=post-content><p>This article provide a straightforward guide to dockerizing NestJS application for both develpoment and production environments.</p><hr><h2 id=dockerfile-for-development>Dockerfile for Development<a hidden class=anchor aria-hidden=true href=#dockerfile-for-development>#</a></h2><p>First, let&rsquo;s create a <code>Dockerfile.dev</code> for the development environment within our NestJS repository:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=c># Dockerfile.dev</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:20-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /usr/src/app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 3000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;npm&#34;</span><span class=p>,</span> <span class=s2>&#34;run&#34;</span><span class=p>,</span> <span class=s2>&#34;start:dev&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm install<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span></code></pre></div><p>In this Dockerfile, we specify the Node.js version along with the Alpine Linux distribution to minimize the image size. Note the order of commands such as <code>EXPOSE</code> and <code>CMD</code> to optimize Docker&rsquo;s caching mechanism. Since code modifications are frequent during development, we place the <code>COPY</code> command towards the end of the Dockerfile to reduce rebuild time.</p><p>Now, let&rsquo;s build the image from <code>Dockerfile.dev</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker build -t nest-dev -f Dockerfile.dev .
</span></span></code></pre></div><p>After building, let&rsquo;s check the image size:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker images
</span></span><span class=line><span class=cl>REPOSITORY                  TAG       IMAGE ID       CREATED              SIZE
</span></span><span class=line><span class=cl>nest-dev                    latest    7105d40d77e3   About a minute ago   327MB
</span></span></code></pre></div><p>Building this Docker image with the base image <code>node:w0-alpine</code> yields a size of 327MB, which is quite efficient. However, if we were to use <code>node:20</code> instead of <code>node:20-alpine</code> as the base image, the image size would increase significantly, up to 1.29GB.</p><h2 id=dockerfile-for-production>Dockerfile for Production<a hidden class=anchor aria-hidden=true href=#dockerfile-for-production>#</a></h2><p>Even though 327MB is relatively small, we can further optimize the image size for the production environment by removing unnecessary files and packages during the build process. Here&rsquo;s the <code>Dockerfile.prod</code> for production:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> node:20-alpine AS builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm install <span class=o>&amp;&amp;</span> npm run build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm install --prod<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:20-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /usr/src/app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /node_modules ./node_modules<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /dist ./dist<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 3000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;node&#34;</span><span class=p>,</span> <span class=s2>&#34;./dist/main&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>In this Dockerfile, we utilize <strong>Multi-stage builds</strong> to first compile the TypeScript code into JavaScript and then install only the production dependencies, thereby significantly reducing the image size.</p><p>Let&rsquo;s build the production image and compare the size difference with the development version:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker build -t nest-prod -f Dockerfile.prod .
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker images
</span></span><span class=line><span class=cl>REPOSITORY                  TAG       IMAGE ID       CREATED              SIZE
</span></span><span class=line><span class=cl>nest-dev                    latest    7105d40d77e3   About a minute ago   327MB
</span></span><span class=line><span class=cl>nest-prod                   latest    04f3894b4cf6   <span class=m>5</span> minutes ago        141MB
</span></span></code></pre></div><p>As you can see, the production image size is half of the development version, resulting in reduced tranportation time and storage requirements.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://hsuanblog.live/tags/nodejs/>NodeJS</a></li><li><a href=https://hsuanblog.live/tags/nestjs/>NestJS</a></li><li><a href=https://hsuanblog.live/tags/back-end/>Back-End</a></li><li><a href=https://hsuanblog.live/tags/docker/>Docker</a></li></ul><nav class=paginav><a class=next href=https://hsuanblog.live/posts/laravel-%E9%97%9C%E8%81%AF-model/><span class=title>Next »</span><br><span>Laravel 關聯 Model</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://hsuanblog.live/>Hsuan's Coding Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>