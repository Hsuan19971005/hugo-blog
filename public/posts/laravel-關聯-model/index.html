<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Laravel 關聯 Model | Hsuan's Coding Blog</title>
<meta name=keywords content="Laravel,ORM,Back-end"><meta name=description content="Laravel 關聯性Model基礎操作：belongs_to, has_one, has_many, many to many
1. 一對一關係 has_one 假設兩個Model：店主Owner、商店Store，店主擁有一間商店(Owner has one Store)，商店屬於一位店主(Store belongs to Owner)。
Owner: - id - name Store: - id - name - owner_id 首先要為Store創建欄位owner_id，在migration中可以使用$table->foreignId('owner_id')建立欄位(foreignId等同於unsignedBigInt)。
Owner.php中寫入hasOne：
// app/Models/Owner.php public function store() { return $this->hasOne(Store::class); } Store.php中寫入belonsTo：
// app/Models/Store.php public function owner() { return $this->belongsTo(Owner::class); } 使用方法：
// 從Owner角度建立Store // 方法一：使用create $o1 = Owner::find(1); $o1->store()->create(['name'=>'store1']); // 方法二：使用save $o1 = Owner::find(1); $s2 = new Store(['name'=?'store2']); $o1->store()->save($s2); // 從Store角度建立Owner $o2 = Owner::find(2); $s3 = new Store(['name'=>'store3']); $s3->owner()->associate($o2); $s3->save(); // 撈取該Owner的Store $o1->store; $o1->store->name; // 撈取該Store的Owner $s1->owner; $s1->owner->name; hasOne與belongsTo都可以獨立設置foreign key或owner key："><meta name=author content="HSIAO, YI-HUSAN"><link rel=canonical href=https://hsuanblog.live/posts/laravel-%E9%97%9C%E8%81%AF-model/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://hsuanblog.live/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://hsuanblog.live/posts/laravel-%E9%97%9C%E8%81%AF-model/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Laravel 關聯 Model"><meta property="og:description" content="Laravel 關聯性Model基礎操作：belongs_to, has_one, has_many, many to many
1. 一對一關係 has_one 假設兩個Model：店主Owner、商店Store，店主擁有一間商店(Owner has one Store)，商店屬於一位店主(Store belongs to Owner)。
Owner: - id - name Store: - id - name - owner_id 首先要為Store創建欄位owner_id，在migration中可以使用$table->foreignId('owner_id')建立欄位(foreignId等同於unsignedBigInt)。
Owner.php中寫入hasOne：
// app/Models/Owner.php public function store() { return $this->hasOne(Store::class); } Store.php中寫入belonsTo：
// app/Models/Store.php public function owner() { return $this->belongsTo(Owner::class); } 使用方法：
// 從Owner角度建立Store // 方法一：使用create $o1 = Owner::find(1); $o1->store()->create(['name'=>'store1']); // 方法二：使用save $o1 = Owner::find(1); $s2 = new Store(['name'=?'store2']); $o1->store()->save($s2); // 從Store角度建立Owner $o2 = Owner::find(2); $s3 = new Store(['name'=>'store3']); $s3->owner()->associate($o2); $s3->save(); // 撈取該Owner的Store $o1->store; $o1->store->name; // 撈取該Store的Owner $s1->owner; $s1->owner->name; hasOne與belongsTo都可以獨立設置foreign key或owner key："><meta property="og:type" content="article"><meta property="og:url" content="https://hsuanblog.live/posts/laravel-%E9%97%9C%E8%81%AF-model/"><meta property="og:image" content="https://hsuanblog.live/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-19T00:00:00+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://hsuanblog.live/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Laravel 關聯 Model"><meta name=twitter:description content="Laravel 關聯性Model基礎操作：belongs_to, has_one, has_many, many to many
1. 一對一關係 has_one 假設兩個Model：店主Owner、商店Store，店主擁有一間商店(Owner has one Store)，商店屬於一位店主(Store belongs to Owner)。
Owner: - id - name Store: - id - name - owner_id 首先要為Store創建欄位owner_id，在migration中可以使用$table->foreignId('owner_id')建立欄位(foreignId等同於unsignedBigInt)。
Owner.php中寫入hasOne：
// app/Models/Owner.php public function store() { return $this->hasOne(Store::class); } Store.php中寫入belonsTo：
// app/Models/Store.php public function owner() { return $this->belongsTo(Owner::class); } 使用方法：
// 從Owner角度建立Store // 方法一：使用create $o1 = Owner::find(1); $o1->store()->create(['name'=>'store1']); // 方法二：使用save $o1 = Owner::find(1); $s2 = new Store(['name'=?'store2']); $o1->store()->save($s2); // 從Store角度建立Owner $o2 = Owner::find(2); $s3 = new Store(['name'=>'store3']); $s3->owner()->associate($o2); $s3->save(); // 撈取該Owner的Store $o1->store; $o1->store->name; // 撈取該Store的Owner $s1->owner; $s1->owner->name; hasOne與belongsTo都可以獨立設置foreign key或owner key："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hsuanblog.live/posts/"},{"@type":"ListItem","position":2,"name":"Laravel 關聯 Model","item":"https://hsuanblog.live/posts/laravel-%E9%97%9C%E8%81%AF-model/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Laravel 關聯 Model","name":"Laravel 關聯 Model","description":"Laravel 關聯性Model基礎操作：belongs_to, has_one, has_many, many to many\n1. 一對一關係 has_one 假設兩個Model：店主Owner、商店Store，店主擁有一間商店(Owner has one Store)，商店屬於一位店主(Store belongs to Owner)。\nOwner: - id - name Store: - id - name - owner_id 首先要為Store創建欄位owner_id，在migration中可以使用$table-\u0026gt;foreignId('owner_id')建立欄位(foreignId等同於unsignedBigInt)。\nOwner.php中寫入hasOne：\n// app/Models/Owner.php public function store() { return $this-\u0026gt;hasOne(Store::class); } Store.php中寫入belonsTo：\n// app/Models/Store.php public function owner() { return $this-\u0026gt;belongsTo(Owner::class); } 使用方法：\n// 從Owner角度建立Store // 方法一：使用create $o1 = Owner::find(1); $o1-\u0026gt;store()-\u0026gt;create([\u0026#39;name\u0026#39;=\u0026gt;\u0026#39;store1\u0026#39;]); // 方法二：使用save $o1 = Owner::find(1); $s2 = new Store([\u0026#39;name\u0026#39;=?\u0026#39;store2\u0026#39;]); $o1-\u0026gt;store()-\u0026gt;save($s2); // 從Store角度建立Owner $o2 = Owner::find(2); $s3 = new Store([\u0026#39;name\u0026#39;=\u0026gt;\u0026#39;store3\u0026#39;]); $s3-\u0026gt;owner()-\u0026gt;associate($o2); $s3-\u0026gt;save(); // 撈取該Owner的Store $o1-\u0026gt;store; $o1-\u0026gt;store-\u0026gt;name; // 撈取該Store的Owner $s1-\u0026gt;owner; $s1-\u0026gt;owner-\u0026gt;name; hasOne與belongsTo都可以獨立設置foreign key或owner key：","keywords":["Laravel","ORM","Back-end"],"articleBody":"Laravel 關聯性Model基礎操作：belongs_to, has_one, has_many, many to many\n1. 一對一關係 has_one 假設兩個Model：店主Owner、商店Store，店主擁有一間商店(Owner has one Store)，商店屬於一位店主(Store belongs to Owner)。\nOwner: - id - name Store: - id - name - owner_id 首先要為Store創建欄位owner_id，在migration中可以使用$table-\u003eforeignId('owner_id')建立欄位(foreignId等同於unsignedBigInt)。\nOwner.php中寫入hasOne：\n// app/Models/Owner.php public function store() { return $this-\u003ehasOne(Store::class); } Store.php中寫入belonsTo：\n// app/Models/Store.php public function owner() { return $this-\u003ebelongsTo(Owner::class); } 使用方法：\n// 從Owner角度建立Store // 方法一：使用create $o1 = Owner::find(1); $o1-\u003estore()-\u003ecreate(['name'=\u003e'store1']); // 方法二：使用save $o1 = Owner::find(1); $s2 = new Store(['name'=?'store2']); $o1-\u003estore()-\u003esave($s2); // 從Store角度建立Owner $o2 = Owner::find(2); $s3 = new Store(['name'=\u003e'store3']); $s3-\u003eowner()-\u003eassociate($o2); $s3-\u003esave(); // 撈取該Owner的Store $o1-\u003estore; $o1-\u003estore-\u003ename; // 撈取該Store的Owner $s1-\u003eowner; $s1-\u003eowner-\u003ename; hasOne與belongsTo都可以獨立設置foreign key或owner key：\npublic function owner() { return $this-\u003ebelongsTo(Owner::class, 'foreign_key', 'owner_key'); } public function store() { return $this-\u003ehasOne(Store::class, 'foreign_key', 'owner_key'); } 2. 一對多關係 has_many 假設兩個Model：商店Store、書籍Book，商店擁有多本書籍(Store has many books)，書籍屬於一個商店(Book belongs to Store)。\nStore: - id - name Book: - id - name - store_id 為Book創建欄位store_id。\n在Store.php中寫入hasMany：\npublic function books() { return $this-\u003ehasMany(Book::class); } 在Book.php中寫入belongsTo：\npublic function store() { return $this-\u003ebelongsTo(Store::class); } 使用方式：\n// 從Store角度建立Book // 方法一：使用create $s1 = Store::find(1); $s1-\u003ebooks()-\u003ecreateMany([ ['name'=\u003e'book1'], ['name'=\u003e'book2'] ]); // 方法二：使用save $s1 = Store::find(1); $s1-\u003ebooks()-\u003esaveMany([ new Book(['name'=\u003e'book4']), new Book(['name'=\u003e'book5']) ]); $books = Book::where('name', 'like', 'book%')-\u003eget(); $s1-\u003ebooks()-\u003esaveMany($books); // 從Book角度建立Store $b1 = new Book(['name'=\u003e'book3']); $s1 = Store::find(1); $b3-\u003estore()-\u003eassociate($s1); $b3-\u003esave(); // 撈取該Store的Book $s1-\u003ebooks; $s1-\u003ebooks()-\u003ewhere('name', 'like', 'book%')-\u003eget(); // 撈取該Book的store $b1-\u003estore; hasMany可以獨立設置foreign key和owner key：\nreturn $this-\u003ehasMany(Comment::class, 'foreign_key', 'local_key'); 3. 多對多關係 Many to Many 假設兩個Model：書籍Book、作者Author，書籍有多位作者(book has many authors)，作者有撰寫多本書籍(author has many books)，此時會需要中間資料表author_book用來紀錄兩者的關係，要有欄位book_id、author_id，表格名稱內的Model名稱是依照字母排序。\n建立中間資料表author_book：\nphp artisan make:migration create_author_book_table Schema::create('author_book', function (Blueprint $table) { $table-\u003eid(); $table-\u003eforeignId('author_id'); $table-\u003eforeignId('book_id'); }); 接著在Book與Author都加上belongsToMany：\n// Book.php public function authors(){ return $this-\u003ebelongsToMany(Author::class); } // Author.php public function books(){ return $this-\u003ebelongsToMany(Book::class); } 一樣可以單獨設定第三方資料表名稱與key名稱：\nreturn $this-\u003ebelongsToMany(Role::class, 'role_user', 'user_id', 'role_id'); 使用方法：\n// 兩筆資料建立關係 // 方法ㄧ：使用save, saveMany $b1 = Book::find(1); $a1 = Author::find(1); $b1-\u003eauthors()-\u003esave($a1); $authors = Author::whereIn('id', [2, 3])-\u003eget(); $b1-\u003eauthors()-\u003esaveMany($authors); // 方法ㄧ：使用attach, detach $b1 = Book::find(1); $a1 = Author::find(1); $b2-\u003eauthors()-\u003eattach($a2-\u003eid); // add relation $b2-\u003eauthors()-\u003edetach($a2-\u003eid); // remove relation // 撈取資料 $b1-\u003eauthors; $a1-\u003ebooks; references https://laravel.com/docs/8.x/eloquent-relationships ","wordCount":"295","inLanguage":"en","image":"https://hsuanblog.live/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-01-19T00:00:00Z","dateModified":"2024-01-19T00:00:00Z","author":{"@type":"Person","name":"HSIAO, YI-HUSAN"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://hsuanblog.live/posts/laravel-%E9%97%9C%E8%81%AF-model/"},"publisher":{"@type":"Organization","name":"Hsuan's Coding Blog","logo":{"@type":"ImageObject","url":"https://hsuanblog.live/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://hsuanblog.live/ accesskey=h title="Hsuan's Coding Blog (Alt + H)"><img src=https://hsuanblog.live/apple-touch-icon.png alt aria-label=logo height=35>Hsuan's Coding Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hsuanblog.live/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://hsuanblog.live/categories/ title=categories><span>categories</span></a></li><li><a href=https://hsuanblog.live/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hsuanblog.live/>Home</a>&nbsp;»&nbsp;<a href=https://hsuanblog.live/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Laravel 關聯 Model</h1><div class=post-meta><span title='2024-01-19 00:00:00 +0000 UTC'>January 19, 2024</span>&nbsp;·&nbsp;295 words&nbsp;·&nbsp;HSIAO, YI-HUSAN</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1-一對一關係-has_one>1. 一對一關係 has_one</a></li><li><a href=#2-一對多關係-has_many>2. 一對多關係 has_many</a></li><li><a href=#3-多對多關係-many-to-many>3. 多對多關係 Many to Many</a></li><li><a href=#references>references</a></li></ul></nav></div></details></div><div class=post-content><p>Laravel 關聯性Model基礎操作：belongs_to, has_one, has_many, many to many</p><hr><h2 id=1-一對一關係-has_one>1. 一對一關係 has_one<a hidden class=anchor aria-hidden=true href=#1-一對一關係-has_one>#</a></h2><p>假設兩個Model：店主Owner、商店Store，店主擁有一間商店(Owner has one Store)，商店屬於一位店主(Store belongs to Owner)。</p><pre tabindex=0><code>Owner:
- id
- name

Store:
- id
- name
- owner_id
</code></pre><p>首先要為Store創建欄位<code>owner_id</code>，在migration中可以使用<code>$table->foreignId('owner_id')</code>建立欄位(foreignId等同於unsignedBigInt)。</p><p><code>Owner.php</code>中寫入<code>hasOne</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// app/Models/Owner.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>hasOne</span><span class=p>(</span><span class=nx>Store</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>Store.php</code>中寫入<code>belonsTo</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// app/Models/Store.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=nf>owner</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>belongsTo</span><span class=p>(</span><span class=nx>Owner</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>使用方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 從Owner角度建立Store
</span></span></span><span class=line><span class=cl><span class=c1>// 方法一：使用create
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$o1</span> <span class=o>=</span> <span class=nx>Owner</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$o1</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>create</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;store1&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 方法二：使用save
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$o1</span> <span class=o>=</span> <span class=nx>Owner</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$s2</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Store</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=o>=?</span><span class=s1>&#39;store2&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nv>$o1</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>(</span><span class=nv>$s2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 從Store角度建立Owner
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$o2</span> <span class=o>=</span> <span class=nx>Owner</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$s3</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Store</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;store3&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nv>$s3</span><span class=o>-&gt;</span><span class=na>owner</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>associate</span><span class=p>(</span><span class=nv>$o2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$s3</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 撈取該Owner的Store
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$o1</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$o1</span><span class=o>-&gt;</span><span class=na>store</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 撈取該Store的Owner
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$s1</span><span class=o>-&gt;</span><span class=na>owner</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$s1</span><span class=o>-&gt;</span><span class=na>owner</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</span></span></code></pre></div><p><code>hasOne</code>與<code>belongsTo</code>都可以獨立設置foreign key或owner key：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>owner</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>belongsTo</span><span class=p>(</span><span class=nx>Owner</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;foreign_key&#39;</span><span class=p>,</span> <span class=s1>&#39;owner_key&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>hasOne</span><span class=p>(</span><span class=nx>Store</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;foreign_key&#39;</span><span class=p>,</span> <span class=s1>&#39;owner_key&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=2-一對多關係-has_many>2. 一對多關係 has_many<a hidden class=anchor aria-hidden=true href=#2-一對多關係-has_many>#</a></h2><p>假設兩個Model：商店Store、書籍Book，商店擁有多本書籍(Store has many books)，書籍屬於一個商店(Book belongs to Store)。</p><pre tabindex=0><code>Store:
- id
- name

Book:
- id
- name
- store_id
</code></pre><p>為Book創建欄位<code>store_id</code>。</p><p>在<code>Store.php</code>中寫入<code>hasMany</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>books</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>hasMany</span><span class=p>(</span><span class=nx>Book</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在<code>Book.php</code>中寫入<code>belongsTo</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>belongsTo</span><span class=p>(</span><span class=nx>Store</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>使用方式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 從Store角度建立Book
</span></span></span><span class=line><span class=cl><span class=c1>// 方法一：使用create
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$s1</span> <span class=o>=</span> <span class=nx>Store</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$s1</span><span class=o>-&gt;</span><span class=na>books</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>createMany</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;book1&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;book2&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 方法二：使用save
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$s1</span> <span class=o>=</span> <span class=nx>Store</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$s1</span><span class=o>-&gt;</span><span class=na>books</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>saveMany</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=nx>Book</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;book4&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=nx>Book</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;book5&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$books</span> <span class=o>=</span> <span class=nx>Book</span><span class=o>::</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;like&#39;</span><span class=p>,</span> <span class=s1>&#39;book%&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$s1</span><span class=o>-&gt;</span><span class=na>books</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>saveMany</span><span class=p>(</span><span class=nv>$books</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 從Book角度建立Store
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$b1</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Book</span><span class=p>([</span><span class=s1>&#39;name&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;book3&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nv>$s1</span> <span class=o>=</span> <span class=nx>Store</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$b3</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>associate</span><span class=p>(</span><span class=nv>$s1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$b3</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 撈取該Store的Book
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$s1</span><span class=o>-&gt;</span><span class=na>books</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$s1</span><span class=o>-&gt;</span><span class=na>books</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;like&#39;</span><span class=p>,</span> <span class=s1>&#39;book%&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 撈取該Book的store
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$b1</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>;</span>
</span></span></code></pre></div><p><code>hasMany</code>可以獨立設置foreign key和owner key：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>hasMany</span><span class=p>(</span><span class=nx>Comment</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;foreign_key&#39;</span><span class=p>,</span> <span class=s1>&#39;local_key&#39;</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=3-多對多關係-many-to-many>3. 多對多關係 Many to Many<a hidden class=anchor aria-hidden=true href=#3-多對多關係-many-to-many>#</a></h2><p>假設兩個Model：書籍Book、作者Author，書籍有多位作者(book has many authors)，作者有撰寫多本書籍(author has many books)，此時會需要中間資料表author_book用來紀錄兩者的關係，要有欄位<code>book_id</code>、<code>author_id</code>，表格名稱內的Model名稱是依照字母排序。</p><p>建立中間資料表author_book：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php artisan make:migration create_author_book_table
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Schema</span><span class=o>::</span><span class=na>create</span><span class=p>(</span><span class=s1>&#39;author_book&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Blueprint</span> <span class=nv>$table</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>foreignId</span><span class=p>(</span><span class=s1>&#39;author_id&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>foreignId</span><span class=p>(</span><span class=s1>&#39;book_id&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>接著在<code>Book</code>與<code>Author</code>都加上<code>belongsToMany</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Book.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=nf>authors</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>belongsToMany</span><span class=p>(</span><span class=nx>Author</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Author.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=nf>books</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>belongsToMany</span><span class=p>(</span><span class=nx>Book</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>一樣可以單獨設定第三方資料表名稱與key名稱：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>belongsToMany</span><span class=p>(</span><span class=nx>Role</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=s1>&#39;role_user&#39;</span><span class=p>,</span> <span class=s1>&#39;user_id&#39;</span><span class=p>,</span> <span class=s1>&#39;role_id&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>使用方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 兩筆資料建立關係
</span></span></span><span class=line><span class=cl><span class=c1>// 方法ㄧ：使用save, saveMany
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$b1</span> <span class=o>=</span> <span class=nx>Book</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$a1</span> <span class=o>=</span> <span class=nx>Author</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$b1</span><span class=o>-&gt;</span><span class=na>authors</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>save</span><span class=p>(</span><span class=nv>$a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$authors</span> <span class=o>=</span> <span class=nx>Author</span><span class=o>::</span><span class=na>whereIn</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$b1</span><span class=o>-&gt;</span><span class=na>authors</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>saveMany</span><span class=p>(</span><span class=nv>$authors</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 方法ㄧ：使用attach, detach
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$b1</span> <span class=o>=</span> <span class=nx>Book</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$a1</span> <span class=o>=</span> <span class=nx>Author</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$b2</span><span class=o>-&gt;</span><span class=na>authors</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>attach</span><span class=p>(</span><span class=nv>$a2</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>);</span> <span class=c1>// add relation
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$b2</span><span class=o>-&gt;</span><span class=na>authors</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>detach</span><span class=p>(</span><span class=nv>$a2</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>);</span> <span class=c1>// remove relation
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 撈取資料
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$b1</span><span class=o>-&gt;</span><span class=na>authors</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$a1</span><span class=o>-&gt;</span><span class=na>books</span><span class=p>;</span>
</span></span></code></pre></div><hr><h2 id=references>references<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://laravel.com/docs/8.x/eloquent-relationships>https://laravel.com/docs/8.x/eloquent-relationships</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://hsuanblog.live/tags/laravel/>Laravel</a></li><li><a href=https://hsuanblog.live/tags/orm/>ORM</a></li><li><a href=https://hsuanblog.live/tags/back-end/>Back-End</a></li></ul><nav class=paginav><a class=prev href=https://hsuanblog.live/posts/nestdocker/><span class=title>« Prev</span><br><span>How to Dockerize NestJS</span>
</a><a class=next href=https://hsuanblog.live/posts/php-%E4%BD%BF%E7%94%A8%E7%AD%86%E8%A8%98/><span class=title>Next »</span><br><span>PHP 使用筆記</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://hsuanblog.live/>Hsuan's Coding Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>